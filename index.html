<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>OOO msg generator</title>
    <style>
      html {
        box-sizing: border-box;
      }
      *,
      *::after,
      *::before {
        box-sizing: inherit;
      }
      body {
        max-width: 1000px;
        margin: 1rem auto;
        padding: 0 1rem;
        font-family: Helvetica, Arial, sans-serif;
      }
      input[type="text"],
      input[type="email"],
      input[type="tel"],
      input[type="date"],
      button {
        font: inherit;
        padding: 3px;
        width: 100%;
        border: 1px solid #00000085;
      }
      label {
        cursor: pointer;
      }
      .buttons {
        display: flex;
      }
      button {
        padding: 0.5rem 1rem;
        background-color: lightgray;
        color: black;
        flex-grow: 1;
      }
      button:first-child {
        margin-right: 0.5rem;
        flex-basis: 38%;
      }
      button:last-child {
        flex-basis: 62%;
      }
      .row {
        margin: 1rem 0;
      }
      .row:first-child {
        margin-top: 0;
      }
      #oooMsg {
        padding: 0 1rem;
        display: block;
        border: 1px solid #00000085;
      }

      @media (min-width: 500px) {
        .container {
          display: flex;
          margin: 1rem 0;
        }
        .form {
          flex-basis: 50%;
          margin-right: 1rem;
        }
        .output {
          flex-basis: 50%;
          display: flex;
          flex-direction: column;
          justify-content: space-between;
        }
        #oooMsg {
          flex-grow: 1;
        }
      }
    </style>
  </head>
  <body>
    <h1>Out of office message generator</h1>

    <div class="container">
      <div class="form">
        <div class="row">
          <label for="oooFrom">Out from</label><br />
          <input type="date" id="oooFrom" onchange="generate()" /><br />
          <label for="oooUntil">until</label><br />
          <input type="date" id="oooUntil" onchange="generate()" />
        </div>
        <div class="row">
          <input
            type="checkbox"
            id="accessToEmail"
            checked
            onchange="generate()"
          />
          <label for="accessToEmail">Access to e-mail</label>
        </div>
        <div class="row">
          <label for="urgentPhone">Mobile for urgency</label><br />
          <input
            type="tel"
            id="urgentPhone"
            placeholder="+39.321.1231231"
            onchange="generate()"
          />
        </div>
        <div class="row">
          <label for="immediateEmail">Contact for immediate assistance</label
          ><br />
          <input
            type="email"
            id="immediateEmail"
            placeholder="another.person@domain.com"
            onchange="generate()"
          />
        </div>
        <div class="row">
          <label for="signature">Signature</label><br />
          <input
            type="text"
            name="name"
            autocomplete="name"
            id="signature"
            placeholder="Name Surname"
            onchange="generate()"
          />
        </div>
        <div class="buttons row">
          <button id="generate" onclick="generate()">Generate</button>
          <button id="copyToClipboard" onclick="copyToClipboard()">
            Copy to clipboard <span class="status"></span>
          </button>
        </div>
      </div>

      <div class="output">
        Here's your generated OOO message<br />
        <output id="oooMsg" contenteditable>
          <p>Your OOO message will appear here</p>
        </output>
        <p>Enjoy your leave 👋</p>
      </div>
    </div>

    <script>
      var clipboardStatusTimeout;
      const oooFrom = document.getElementById("oooFrom");
      const oooUntil = document.getElementById("oooUntil");
      const oooMsg = document.getElementById("oooMsg");
      const accessToEmail = document.getElementById("accessToEmail");
      const urgentPhone = document.getElementById("urgentPhone");
      const immediateEmail = document.getElementById("immediateEmail");
      const copyToClipboardStatus = document.querySelector(
        "#copyToClipboard .status"
      );

      const getImmediateAssistanceMsg = (value, from, until) => {
        if (!value) return "";
        const isOneDay = from === until;
        const whenImOoo = isOneDay
          ? "If you need immediate assistance"
          : "In my absence";
        return `<p>${whenImOoo}, please contact ${value}.</p>`;
      };

      const getUrgentMobileMsg = value => {
        if (!value) return "";
        return `<p>If your matter requires my urgent attention, you can reach me directly on ${value}</p>`;
      };

      const formatDate = dateString => {
        const date = new Date(dateString);
        const options = {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric"
        };
        return date.toLocaleDateString("en-gb", options);
      };

      const getTimeSpanMsg = (from, until) => {
        const isOneDay = from === until;
        return isOneDay
          ? `on ${formatDate(from)}`
          : `from ${formatDate(from)} until ${formatDate(until)}`;
      };

      const getSignature = value => {
        if (!value) return "";
        return `<p>${value}</p>`;
      };

      const generate = () => {
        oooMsg.innerHTML = `
          <p>Hi,<br>
          thanks for getting in touch.</p>
          <p>I will be out of office
            ${getTimeSpanMsg(oooFrom.value, oooUntil.value)}
            with ${accessToEmail.checked ? "limited" : "no"}
            access to e-mail.</p>
            <p>I will respond to your email upon my return.
            ${getImmediateAssistanceMsg(
              immediateEmail.value,
              oooFrom.value,
              oooUntil.value
            )}</p>
            ${getUrgentMobileMsg(urgentPhone.value)}
            ${getSignature(signature.value)}
        `;
      };

      const setClipboard = text => {
        navigator.clipboard.writeText(text).then(
          () => {
            copyToClipboardStatus.innerText = "👍";
          },
          err => {
            copyToClipboardStatus.innerText = "❌";
          }
        );
        clearTimeout(clipboardStatusTimeout);
        clipboardStatusTimeout = setTimeout(() => {
          copyToClipboardStatus.innerText = "";
        }, 1000);
      };

      const copyToClipboard = () => {
        setClipboard(oooMsg.innerText);
      };

      const initialize = () => {
        // Initialization
        oooFrom.valueAsNumber = Date.now();
        oooUntil.valueAsNumber = Date.now();

        // Get values from QueryString
        const urlParams = new URLSearchParams(window.location.search);
        immediateEmail.value = urlParams.get("immediateEmail");
        signature.value = urlParams.get("signature");
        urgentPhone.value = urlParams.get("urgentPhone");
        accessToEmail.checked = urlParams.get("accessToEmail") === "yes";
      };

      initialize();
      generate();
    </script>
  </body>
</html>
